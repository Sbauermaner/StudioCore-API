# Отчет о рефакторинге extract_sections() в text_utils.py

## Проблема
Функция `extract_sections()` имела:
- Размер: 126 строк
- Сложность: 34
- Множество вложенных условий и циклов

## Решение
Разбита на логические функции для улучшения читаемости и поддерживаемости.

### Выделенные функции

#### 1. `_parse_section_marker()` (новая)
- **Назначение**: Парсинг маркера секции из строки
- **Возвращает**: Извлеченный тег или None если маркер не найден
- **Размер**: ~15 строк
- **Обрабатывает**: 
  - Квадратные скобки: `[Verse 1]`
  - Заголовки с двоеточием: `Припев:`
  - Круглые скобки: `(Куплет 1)`

#### 2. `_normalize_section_tag()` (новая)
- **Назначение**: Нормализация тега секции (русские → английские)
- **Возвращает**: Нормализованный тег
- **Размер**: ~30 строк
- **Преобразует**:
  - "куплет" → "Verse" / "Verse 1" / "Verse 2" / "Verse 3"
  - "припев" → "Chorus" / "Final Chorus"
  - "мост" → "Bridge"
  - "аутро" → "Outro"
  - "интро" → "Intro"
  - "преприпев" → "Pre-Chorus"

#### 3. `_close_section()` (новая)
- **Назначение**: Закрытие текущей секции и добавление в список
- **Размер**: ~10 строк
- **Логика**:
  - Проверяет наличие содержимого
  - Удаляет пустые строки в конце
  - Добавляет секцию в список

#### 4. `_split_by_empty_lines()` (новая)
- **Назначение**: Разбиение текста на секции по двойным пустым строкам
- **Возвращает**: Список секций (все с тегом "Body")
- **Размер**: ~35 строк
- **Логика**:
  - Отслеживает количество пустых строк подряд
  - При 2+ пустых строках создает новую секцию
  - Очищает пустые строки в конце каждой секции

#### 5. `_clean_section_lines()` (новая)
- **Назначение**: Удаление пустых строк внутри секций
- **Размер**: ~5 строк
- **Логика**: Фильтрует строки, оставляя только непустые

### Результат

**До рефакторинга**:
- `extract_sections()`: 126 строк, сложность 34

**После рефакторинга**:
- `extract_sections()`: ~50 строк, сложность ~10
- 5 новых вспомогательных функций с четкими обязанностями

### Преимущества

1. ✅ **Улучшенная читаемость**: Каждая функция имеет четкую цель
2. ✅ **Упрощенное тестирование**: Каждую функцию можно тестировать отдельно
3. ✅ **Улучшенная поддерживаемость**: Изменения в одной части не затрагивают другие
4. ✅ **Сниженная сложность**: Основная функция `extract_sections()` теперь намного проще
5. ✅ **Повторное использование**: Вспомогательные функции можно использовать в других местах
6. ✅ **Лучшая обработка ошибок**: Каждая функция может иметь свою логику обработки ошибок

### Структура после рефакторинга

```
extract_sections()
├── _parse_section_marker()      # Парсинг маркеров
├── _normalize_section_tag()     # Нормализация тегов
├── _close_section()             # Закрытие секций
├── _split_by_empty_lines()      # Fallback: разбиение по пустым строкам
└── _clean_section_lines()       # Очистка пустых строк
```

## Статус
✅ **Завершено**: Рефакторинг `extract_sections()` выполнен успешно.

