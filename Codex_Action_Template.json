{
  "Codex_Action_Template": {
    "version": "1.0",
    "purpose": "Instruction set for Codex to maintain, repair, synchronize and extend the StudioCore codebase using Codex_Spec.json as the authoritative specification.",

    "steps": {
      "1_load_specification": {
        "description": "Load and parse the file Codex_Spec.json located in the repository root.",
        "input_file": "Codex_Spec.json",
        "outputs": [
          "spec.modules",
          "spec.classes",
          "spec.methods",
          "spec.engine_functions",
          "spec.dependencies",
          "spec.rules",
          "spec.file_generation_rules"
        ]
      },

      "2_scan_repository": {
        "description": "Scan all .py files and all subdirectories in the repository.",
        "outputs": [
          "repo_files",
          "repo_classes",
          "repo_functions",
          "repo_imports",
          "repo_tree_map"
        ]
      },

      "3_compare_spec_with_repo": {
        "description": "Compare the specification with the actual repository structure.",
        "checks": [
          "missing_files",
          "missing_classes",
          "missing_methods",
          "missing_engine_functions",
          "broken_imports",
          "signature_mismatch",
          "deprecated_parameters_usage"
        ],
        "outputs": [
          "ModuleMismatchReport",
          "FunctionMismatchReport",
          "DependencyMismatchReport",
          "DeprecatedUsageReport"
        ]
      },

      "4_generate_autofix_package": {
        "description": "Prepare auto-generated fixes for anything missing or broken based on the specification.",
        "conditions": [
          "file missing but required",
          "class missing but required",
          "function missing but required",
          "import missing but required",
          "signature mismatch",
          "deprecated parameter detected"
        ],
        "autofix_actions": [
          "create_file_stub",
          "create_class_skeleton",
          "create_function_stub",
          "insert_missing_imports",
          "rewrite_signature_to_match_spec",
          "remove_deprecated_parameters"
        ],
        "output": "AutoFixPackage"
      },

      "5_request_user_confirmation": {
        "description": "Ask the user for permission to apply all generated changes.",
        "message": "Codex found inconsistencies and generated fixes. Apply fixes?"
      },

      "6_apply_changes": {
        "description": "Apply all fixes only after explicit user confirmation.",
        "methods": [
          "write_new_files",
          "update_existing_files",
          "append_missing_code",
          "correct_imports"
        ],
        "output": "UpdatedRepository"
      },

      "7_revalidate": {
        "description": "After applying fixes, re-run full validation against Codex_Spec.json.",
        "outputs": [
          "FinalValidationReport",
          "NoRemainingErrors"
        ]
      }
    },

    "safety": {
      "never_overwrite_existing_files_without_confirmation": true,
      "never_delete_files_without_confirmation": true,
      "always_log_changes": true,
      "fail_if_spec_missing": true
    }
  }
}
