# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –≤ Genre Weights**

**–§–∞–π–ª**: `studiocore/genre_weights.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–µ—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –º–æ–≥–ª–∏ –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—É–º–º—ã, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –≤ `__init__()`:
  - –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∑–∞–∂–∞—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [-0.5, 0.5] (–¥–ª—è –≤—ã—á–∏—Ç–∞–Ω–∏—è)
  - –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞ –∑–∞–∂–∞—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0.0, 1.0]
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ `score_domains()`:
  - –ó–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∑–∞–∂–∏–º–∞—é—Ç—Å—è –≤ [0.0, 1.0]
  - –í–µ—Å–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

**–ö–æ–¥**:
```python
# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
self.domain_feature_weights: Dict[str, Dict[str, float]] = {}
for domain, weights in raw_weights.items():
    normalized_weights: Dict[str, float] = {}
    for feat, w in weights.items():
        normalized_weights[feat] = max(-0.5, min(0.5, w)) if w < 0 else max(0.0, min(1.0, w))
    self.domain_feature_weights[domain] = normalized_weights
```

---

### 2. ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ —Å–µ–∫—Ü–∏–π**

**–§–∞–π–ª**: `studiocore/text_utils.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: –¢–µ–∫—Å—Ç –∏–∑ 100 —Å—Ç—Ä–æ–∫ –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è –∫–∞–∫ –æ–¥–Ω–∞ —Å–µ–∫—Ü–∏—è "Body"

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ –ø—É—Å—Ç—ã–º —Å—Ç—Ä–æ–∫–∞–º
- –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ 2+ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Üí —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å–µ–∫—Ü–∏–π
- –¢–µ–∫—Å—Ç —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–µ–∫—Ü–∏–∏ –¥–∞–∂–µ –±–µ–∑ —è–≤–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤

**–ö–æ–¥**:
```python
# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏ ‚Äî –ø–æ–ø—Ä–æ–±—É–µ–º —Ä–∞–∑–±–∏—Ç—å –ø–æ –ø—É—Å—Ç—ã–º —Å—Ç—Ä–æ–∫–∞–º
if not sections or (len(sections) == 1 and sections[0].get("tag") == "Body"):
    # –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ –¥–≤–æ–π–Ω—ã–º –ø—É—Å—Ç—ã–º —Å—Ç—Ä–æ–∫–∞–º –∏–ª–∏ –≥—Ä—É–ø–ø–∞–º –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫
    lines = text.split("\n")
    current_section: List[str] = []
    detected_sections: List[Dict[str, Any]] = []
    empty_line_count = 0
    
    for line in lines:
        if not line.strip():
            empty_line_count += 1
            # –ï—Å–ª–∏ –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å 2+ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –ø–æ–¥—Ä—è–¥ ‚Äî —ç—Ç–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Å–µ–∫—Ü–∏–π
            if empty_line_count >= 2 and current_section:
                section_text = "\n".join(current_section).strip()
                if section_text:
                    detected_sections.append({"tag": "Body", "lines": current_section[:]})
                current_section = []
                empty_line_count = 0
        else:
            empty_line_count = 0
            current_section.append(line)
    
    # –ï—Å–ª–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ –ø—É—Å—Ç—ã–º —Å—Ç—Ä–æ–∫–∞–º –¥–∞–ª–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
    if len(detected_sections) > 1:
        return detected_sections
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –¢–µ–ø–µ—Ä—å —Ç–µ–∫—Å—Ç –∏–∑ 100 —Å—Ç—Ä–æ–∫, —Ä–∞–∑–±–∏—Ç—ã–π –ø—É—Å—Ç—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏, –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ —Å–µ–∫—Ü–∏–∏

---

### 3. ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å `_merge_semantic_hints`**

**–§–∞–π–ª**: `studiocore/core_v6.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ—Ç–æ–¥ –º–æ–≥ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `copy.deepcopy()` –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏–∑–º–µ–Ω—è—é—Ç—Å—è
- –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

**–ö–æ–¥**:
```python
@staticmethod
def _merge_semantic_hints(base: Dict[str, Any], override: Dict[str, Any]) -> Dict[str, Any]:
    """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–ª–∏—è–Ω–∏–µ semantic hints —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –º—É—Ç–∞—Ü–∏–∏ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö."""
    # –°–æ–∑–¥–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é base –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    result: Dict[str, Any] = copy.deepcopy(base) if isinstance(base, dict) else {}
    
    if not isinstance(override, dict):
        return result
    
    for key, value in override.items():
        # –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        safe_value = copy.deepcopy(value) if isinstance(value, (dict, list)) else value
        # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

---

### 4. ‚úÖ **–£–ª—É—á—à–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è dominant_emotion –∏ emotion_curve_max**

**–§–∞–π–ª**: `studiocore/core_v6.py`

**–ü—Ä–æ–±–ª–µ–º–∞**: `max()` –º–æ–≥ –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö —Å–ª–æ–≤–∞—Ä—è—Ö/—Å–ø–∏—Å–∫–∞—Ö

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `max()`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π —Å fallback –Ω–∞ None

**–ö–æ–¥**:
```python
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ dominant_emotion —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø—É—Å—Ç–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è
dominant_emotion = None
if emotion_profile and isinstance(emotion_profile, dict) and emotion_profile:
    try:
        dominant_emotion = max(emotion_profile, key=emotion_profile.get)
    except (ValueError, TypeError):
        dominant_emotion = None

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ emotion_curve_max —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø—É—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞
emotion_curve_max = None
if emotion_curve and isinstance(emotion_curve, (list, tuple)) and emotion_curve:
    try:
        emotion_curve_max = max(emotion_curve)
    except (ValueError, TypeError):
        emotion_curve_max = None
```

---

### 5. ‚úÖ **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ compiler –∏ _legacy_core_cls**

**–§–∞–π–ª**: `studiocore/core_v6.py`

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–∞–Ω–µ–µ
- `compiler` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `_build_engine_bundle()` (—Å—Ç—Ä–æ–∫–∞ 554)
- `_legacy_core_cls` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `_build_engine_bundle()` (—Å—Ç—Ä–æ–∫–∞ 555)

---

## üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –§–∞–π–ª |
|----------|--------|------|
| –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –≤ Genre Weights | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `genre_weights.py` |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—Å–æ–≤ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `genre_weights.py` |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ | ‚úÖ –£–ª—É—á—à–µ–Ω–æ | `text_utils.py` |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å _merge_semantic_hints | ‚úÖ –£–ª—É—á—à–µ–Ω–æ | `core_v6.py` |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏—è max() | ‚úÖ –£–ª—É—á—à–µ–Ω–æ | `core_v6.py` |
| compiler –∏ _legacy_core_cls | ‚úÖ –£–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | `core_v6.py` |

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

1. **–í–µ—Å–∞ —Ç–µ–ø–µ—Ä—å –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è** –∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
2. **–¢–µ–∫—Å—Ç –±–µ–∑ –º–∞—Ä–∫–µ—Ä–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è** –ø–æ –ø—É—Å—Ç—ã–º —Å—Ç—Ä–æ–∫–∞–º
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∞** - –Ω–µ—Ç –º—É—Ç–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ —É–ª—É—á—à–µ–Ω–∞** - –∑–∞—â–∏—Ç–∞ –æ—Ç –ø—É—Å—Ç—ã—Ö —Å–ª–æ–≤–∞—Ä–µ–π/—Å–ø–∏—Å–∫–æ–≤

–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

