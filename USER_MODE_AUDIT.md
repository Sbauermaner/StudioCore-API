# –ê—É–¥–∏—Ç —Ä–µ–∂–∏–º–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 2025-01-XX

## –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π (user overrides) –≤ StudioCore-API.

---

## ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### 1. `preferred_gender` (–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–ª –≤–æ–∫–∞–ª–∞)
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `preferred_gender` > –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `vocal.gender` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è: `"auto"`, `"male"`, `"female"`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `preferred_gender` –∫ `vocal_payload.gender`
- –ï—Å–ª–∏ `preferred_gender != "auto"`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞

### 2. –ü—Ä—è–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (bpm, key, genre, mood)
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –≤ `analyze()`:
  - `bpm=140` ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `bpm.estimate`
  - `key='D minor'` ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.key` –∏ `tonality.key`
  - `genre='rock'` ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.genre`
  - `mood='energetic'` ‚Üí –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.mood`

### 3. `user_overrides` dict
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
  ```python
  user_overrides={'bpm': 120, 'key': 'A major', 'genre': 'jazz'}
  ```
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å –ø—Ä—è–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–ø—Ä—è–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### 4. `vocal_profile`
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ª–æ–≤–∞—Ä—å —Å –≤–æ–∫–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
  ```python
  vocal_profile={'gender': 'female', 'type': 'soprano', 'tone': 'soft'}
  ```
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `UserOverrideManager.apply_to_vocals()`

### 5. `instrumentation`
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:
  ```python
  instrumentation=['piano', 'violin', 'cello']
  ```
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `instrumentation.palette` –∏–ª–∏ `instrumentation.selection`

### 6. `override_debug` (–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è—Ö:
  - `has_overrides`: –µ—Å—Ç—å –ª–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
  - `fields`: –≤—Å–µ –ø–æ–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
  - `applied_overrides`: —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

### 7. `structure_hints`
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–µ–∫—Ü–∏–π
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `_apply_overrides_to_context()`

### 8. `color_state`
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
- –ú–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Ü–≤–µ—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.visual.primary`

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: `preferred_gender` –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –∫ `vocal.gender`

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `preferred_gender` –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –≤ legacy core, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª—Å—è –∫ `vocal_payload.gender` –≤ `_backend_analyze`
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ (`detect_voice_gender`)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```python
# –ë—ã–ª–æ:
voice_gender = vocal_engine.detect_voice_gender(text) if vocal_engine else "auto"

# –°—Ç–∞–ª–æ:
auto_gender = vocal_engine.detect_voice_gender(text) if vocal_engine else "auto"
if preferred_gender and preferred_gender != "auto":
    voice_gender = preferred_gender
else:
    voice_gender = auto_gender if auto_gender != "neutral" else "auto"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ `preferred_gender='male'` ‚Üí `vocal.gender='male'`
- ‚úÖ `preferred_gender='female'` ‚Üí `vocal.gender='female'`
- ‚úÖ `preferred_gender='auto'` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

- **–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:** 8
- **–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:** 8
- **–ü—Ä–æ–±–ª–µ–º—ã –Ω–∞–π–¥–µ–Ω—ã:** 1
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 1

---

## üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `analyze()`:

1. **`preferred_gender`** (str): `"auto"`, `"male"`, `"female"`
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `vocal.gender`

2. **`bpm`** (float): –ß–∏—Å–ª–æ BPM
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `bpm.estimate` –∏ `bpm.manual_override.bpm`

3. **`key`** (str): –ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"D minor"`)
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.key` –∏ `tonality.key`

4. **`genre`** (str): –ñ–∞–Ω—Ä –º—É–∑—ã–∫–∏
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.genre`

5. **`mood`** (str): –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.mood`

6. **`vocal_profile`** (dict): –í–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `vocal.*`

7. **`instrumentation`** (list): –°–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `instrumentation.palette`

8. **`structure_hints`** (list): –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `structure.sections`

9. **`color_state`** (str): –¶–≤–µ—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `style.visual.primary`

10. **`user_overrides`** (dict): –°–ª–æ–≤–∞—Ä—å –≤—Å–µ—Ö –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π
    - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å –ø—Ä—è–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ `preferred_gender` —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ)
- ‚úÖ –ü—Ä—è–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ `user_overrides` dict —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `vocal_profile` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `instrumentation` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ `override_debug`

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** ‚úÖ‚úÖ –†–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω

