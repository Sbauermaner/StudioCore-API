{
  "StudioCore_Spec": {
    "version": "6.3-patch",
    "description": "Unified specification for StudioCore v6.x engines, diagnostics, overrides, Codex-driven code synchronization and patched section/vocal/BPM logic.",
    "required_modules": [
      "__init__.py",
      "core_v6.py",
      "emotion.py",
      "tone.py",
      "rhythm.py",
      "vocals.py",
      "style.py",
      "instrument.py",
      "adapter.py",
      "text_utils.py",
      "monolith_v4_3_1.py",
      "fallback.py",
      "user_override_manager.py"
    ],
    "required_classes": {
      "core_v6.py": [
        "StudioCoreV6"
      ],
      "monolith_v4_3_1.py": [
        "StudioCoreV5"
      ],
      "fallback.py": [
        "StudioCoreFallback"
      ],
      "user_override_manager.py": [
        "UserOverrides",
        "UserOverrideManager"
      ]
    },
    "required_methods": {
      "StudioCoreV6": [
        "analyze",
        "_backend_analyze",
        "_merge_user_params",
        "_auto_generate_missing_params",
        "_finalize_result"
      ],
      "StudioCoreV5": [
        "analyze",
        "emotion",
        "style",
        "tone",
        "rhythm"
      ],
      "StudioCoreFallback": [
        "analyze"
      ],
      "UserOverrides": [
        "__init__",
        "from_dict"
      ],
      "UserOverrideManager": [
        "__init__",
        "resolve_bpm",
        "_get_meta_bpm",
        "apply_to_rhythm",
        "apply_to_style",
        "apply_to_vocals",
        "debug_summary"
      ]
    },
    "logical_engines": [
      "TextStructureEngine",
      "EmotionEngine",
      "ColorEmotionEngine",
      "VocalEngine",
      "BreathingEngine",
      "BPMEngine",
      "MeaningVelocityEngine",
      "TonalityEngine",
      "InstrumentationEngine",
      "REM_Synchronizer",
      "ZeroPulseEngine",
      "CommandInterpreter",
      "StyleEngine",
      "LyricsAnnotationEngine",
      "FinalCompiler",
      "UserOverrideEngine"
    ],
    "engine_functions": {
      "TextStructureEngine": [
        "auto_section_split",
        "detect_intro",
        "detect_verse",
        "detect_prechorus",
        "detect_chorus",
        "detect_bridge",
        "detect_outro",
        "detect_meta_pause",
        "detect_zero_pulse"
      ],
      "EmotionEngine": [
        "emotion_detection",
        "emotion_intensity_curve",
        "emotion_pivot_points",
        "secondary_emotion_detection",
        "emotion_conflict_map"
      ],
      "ColorEmotionEngine": [
        "assign_color_by_emotion",
        "generate_color_wave",
        "color_transition_map"
      ],
      "VocalEngine": [
        "detect_voice_gender",
        "detect_voice_type",
        "detect_voice_tone",
        "detect_vocal_style",
        "vocal_dynamics_map",
        "vocal_intensity_curve"
      ],
      "BreathingEngine": [
        "detect_inhale_points",
        "detect_short_breath",
        "detect_broken_breath",
        "detect_spasms",
        "detect_emotional_breathing",
        "breath_to_emotion_sync"
      ],
      "BPMEngine": [
        "text_bpm_estimation",
        "emotion_bpm_mapping",
        "meaning_bpm_curve",
        "breathing_bpm_integration",
        "poly_rhythm_detection"
      ],
      "MeaningVelocityEngine": [
        "semantic_shift_detection",
        "meaning_acceleration",
        "meaning_fracture_detection",
        "meaning_curve_generation"
      ],
      "TonalityEngine": [
        "mode_detection",
        "major_minor_classifier",
        "section_key_selection",
        "modal_shift_detection",
        "key_transition_curve"
      ],
      "InstrumentationEngine": [
        "instrument_selection",
        "instrument_based_on_emotion",
        "instrument_based_on_voice",
        "instrument_color_sync",
        "instrument_rhythm_sync"
      ],
      "REM_Synchronizer": [
        "detect_layer_conflicts",
        "resolve_layer_conflicts",
        "assign_dominant_layer",
        "align_layers_for_final_output"
      ],
      "ZeroPulseEngine": [
        "detect_zero_pulse",
        "vacuum_beat_state",
        "silence_as_emotion",
        "silence_as_transition"
      ],
      "CommandInterpreter": [
        "detect_commands_in_text",
        "execute_bpm_commands",
        "execute_key_commands",
        "execute_rhythm_commands",
        "execute_emotion_commands"
      ],
      "StyleEngine": [
        "genre_selection",
        "mood_selection",
        "instrumentation_style",
        "vocal_style",
        "visual_style",
        "tone_style",
        "final_style_prompt_build"
      ],
      "LyricsAnnotationEngine": [
        "add_vocal_annotations",
        "add_breath_annotations",
        "add_tonal_annotations",
        "add_emotional_annotations",
        "add_rhythm_annotations"
      ],
      "FinalCompiler": [
        "merge_all_layers",
        "generate_final_structure",
        "generate_final_prompt",
        "generate_final_annotations",
        "consistency_check"
      ],
      "UserOverrideEngine": [
        "resolve_bpm",
        "apply_to_rhythm",
        "apply_to_style",
        "apply_to_vocals"
      ]
    },
    "ColorEmotionEngine": {
      "functions": [
        "assign_color_by_emotion",
        "generate_color_wave",
        "color_transition_map"
      ],
      "expanded": {
        "purpose": "Color defines the energetic field of the song. It influences atmosphere, rhythm, vocal, tone, transitions and style without appearing in the final Suno prompt.",
        "components": {
          "emotion_to_color": {
            "sadness": "blue/cold violet",
            "anger": "red/hot",
            "hope": "gold/turquoise",
            "drama": "deep violet/burgundy",
            "light": "pastel",
            "dark": "deep saturated"
          },
          "tonal_color": {
            "Am": "dark blue",
            "F# minor": "blue-violet",
            "G major": "yellow-green",
            "D minor": "crimson"
          },
          "tlp_color_shift": {
            "truth": "white/blue",
            "love": "warm red/pink",
            "pain": "black-red/purple"
          }
        },
        "influences": {
          "vocal_selection": [
            "soft vs aggressive timbre based on color temperature",
            "whisper/airy vs rasp/drive",
            "gender preference depending on atmosphere"
          ],
          "instrument_selection": [
            "dark colors → low synths, cello, sub-bass",
            "light colors → pads, piano, bright guitars",
            "blue → reverb heavy ambient textures",
            "red → percussion, distortion"
          ],
          "rhythm_bpm": [
            "dark → slower, heavier rhythm",
            "light → faster, airy tempo"
          ],
          "section_transitions": [
            "tone shifts",
            "dynamic curves",
            "emotional breaks",
            "smooth vs sharp transitions"
          ],
          "style_matrix": [
            "blue → cinematic ambient, indie, sad pop",
            "red → trap, dnb, rap",
            "gold → orchestral, epic"
          ]
        },
        "engine_behavior": {
          "color_is_hidden_from_prompt": true,
          "color_updates_tone_sync": true,
          "color_influences_all_engines": true,
          "color_does_not_override_user_commands": true
        },
        "internal_outputs": {
          "color_wave": "dynamic color progression across the song",
          "color_state": "current emotional climate",
          "color_transitions": "section-to-section color shifts",
          "tone_sync": "final combined emotional-tonal color field"
        },
        "symbiosis_protocol": {
          "role": "supportive_correction_layer",
          "priority": "below_user_overrides_below_core_engines",
          "interactions": {
            "EmotionEngine": "refines emotional colors without changing detected emotions",
            "TonalityEngine": "adjusts tonal palette without altering key or mode",
            "BPMEngine": "modulates BPM-feel without altering numeric BPM",
            "VocalEngine": "adjusts vocal color (soft/bright/dark) without changing detected voice type",
            "StyleEngine": "adds hidden atmosphere layer without altering final genre/style text"
          },
          "rules": {
            "never_override_other_engine_output": true,
            "always_operate_additively": true,
            "follow_final_compiler_merging": true,
            "provide_hidden_weights_for_final_blending": true
          },
          "output_flow": {
            "color_wave": "feeds into emotion/tone/bpm layers as reference only",
            "color_state": "feeds into vocal and style engines",
            "color_transitions": "helps smooth section transitions",
            "tone_sync": "feeds into FinalCompiler for final balancing"
          }
        }
      }
    },
    "color_engine_rules": {
      "visibility": {
        "exposed_in_style_prompt": false,
        "exposed_only_if_user_explicitly_requests_color": true
      },
      "internal_usage": [
        "emotion → color map",
        "tone → color harmonic match",
        "pain/truth/love → color shift",
        "BPM → color intensity",
        "structure → color transitions"
      ],
      "dependencies": [
        "emotion.py",
        "tone.py",
        "tlp_engine",
        "rhythm.py",
        "style.py"
      ],
      "purpose": [
        "energy glow",
        "vocal profile correction",
        "instrument selection",
        "section transitions",
        "emotional field stabilization"
      ],
      "output_rules": {
        "write_to_result_json": true,
        "write_to_prompt_suno_style": false,
        "write_to_prompt_suno_lyrics": false,
        "write_to_annotations": false,
        "write_to_internal_diagnostics": true
      }
    },
    "override_priority": [
      "user_overrides",
      "meta_directives",
      "auto_analysis"
    ],
    "reserved_keywords": {
      "deprecated": [
        "mode",
        "overlay"
      ],
      "forbidden": [
        "overlay"
      ]
    },
    "file_generation_rules": {
      "enabled": true,
      "create_missing_files": true,
      "create_missing_classes": true,
      "create_missing_functions": true,
      "add_missing_imports": true,
      "confirm_before_writing": true
    },
    "validation_rules": {
      "must_have_all_modules": true,
      "must_have_all_classes": true,
      "must_have_all_required_methods": true,
      "must_have_all_required_engine_functions": true,
      "no_missing_imports": true,
      "no_signature_mismatches": true,
      "no_type_errors_on_runtime": true
    },
    "relationships": {
      "logical_to_physical": {
        "TextStructureEngine": [
          "core_v6.py",
          "text_utils.py"
        ],
        "EmotionEngine": [
          "core_v6.py",
          "emotion.py"
        ],
        "ColorEmotionEngine": [
          "emotion.py",
          "tone.py",
          "rhythm.py",
          "style.py"
        ],
        "VocalEngine": [
          "core_v6.py",
          "vocals.py"
        ],
        "BPMEngine": [
          "core_v6.py",
          "rhythm.py"
        ],
        "TonalityEngine": [
          "core_v6.py",
          "tone.py"
        ],
        "MeaningVelocityEngine": [
          "core_v6.py"
        ],
        "InstrumentationEngine": [
          "core_v6.py",
          "instrument.py"
        ],
        "StyleEngine": [
          "core_v6.py",
          "style.py"
        ],
        "LyricsAnnotationEngine": [
          "core_v6.py",
          "adapter.py"
        ],
        "FinalCompiler": [
          "core_v6.py",
          "adapter.py"
        ],
        "UserOverrideEngine": [
          "core_v6.py",
          "user_override_manager.py"
        ]
      },
      "fallback_chain": [
        "core_v6.py (StudioCoreV6)",
        "monolith_v4_3_1.py (V5 Monolith)",
        "fallback.py (StudioCoreFallback)"
      ]
    },
    "auto_file_generation_policy": {
      "enabled": true,
      "conditions": [
        "module listed in StudioCore_Spec.required_modules does not have a corresponding file in the repository",
        "class described in orchestrator or engine spec is missing",
        "required_methods from this spec are missing in code",
        "critical dependencies between modules are missing (missing imports or adapters)",
        "a new helper file is required to synchronize layers or resolve conflicts"
      ],
      "actions": [
        "create missing module file with minimal valid code skeleton",
        "create missing class with documented TODO body",
        "create missing functions with stubs that log 'NOT_IMPLEMENTED' and expected signature",
        "add required import statements between modules",
        "register new files in the loader (__init__.py, core_v6.py) when needed"
      ],
      "safety": [
        "every auto-generated file or function must be confirmed by the user before being committed",
        "without user confirmation, changes are kept as draft-only (e.g. separate folder or suffix)",
        "auto-generation must never overwrite an existing file without explicit user confirmation"
      ],
      "integration": [
        "all newly created files must be added to StudioCore_Spec.required_modules or dependencies",
        "new relationships must be added to StudioCore_Spec.relationships",
        "after generation, a validation pass must be executed against this spec"
      ]
    },
    "diagnostics": {
      "validation_requirements": [
        "all modules listed in this spec must exist in the codebase",
        "all classes referenced by orchestrator and engines must exist",
        "all required methods must exist with correct signatures",
        "no deprecated parameters (mode, overlay) are used",
        "no missing imports between modules",
        "V6 must run without TypeError in normal execution"
      ],
      "diagnostic_outputs": [
        "Diagnostics",
        "CommandDiagnostics",
        "LayerSyncMap",
        "ZeroPulseMap"
      ]
    },
    "VocalEngineSpec": {
      "type": "logical_engine",
      "description": "Vocal profile, voice type and dynamics mapping with automatic and user-driven fusion.",
      "extended_vocal_parameters": {
        "timbre": [
          "soft",
          "raspy",
          "warm",
          "airy",
          "gritty"
        ],
        "range": [
          "low",
          "mid",
          "high"
        ],
        "dynamics": [
          "calm",
          "emotional",
          "intense"
        ],
        "techniques": [
          "falsetto",
          "whisper",
          "shout",
          "growl",
          "spoken"
        ]
      },
      "fusion": {
        "allowed_outputs": [
          "solo_male",
          "solo_female",
          "duet_mf",
          "duet_mm",
          "duet_ff",
          "choir_male",
          "choi_female",
          "choir_mixed"
        ],
        "fusion_rules": {
          "priority": "user_first",
          "analysis_weight": 0.65,
          "user_weight": 0.35,
          "max_bias_limit": 0.25
        }
      }
    },
    "meta_parser": {
      "accept_languages": [
        "en",
        "ru",
        "de"
      ],
      "strict_headers": true,
      "allowed_headers": [
        "INTRO",
        "VERSE",
        "VERSE 1",
        "VERSE 2",
        "VERSE 3",
        "CHORUS",
        "CHORUS 1",
        "CHORUS 2",
        "FINAL CHORUS",
        "BRIDGE",
        "HOOK",
        "HOOK/REFRAIN",
        "REFRAIN",
        "OUTRO",
        "PONT",
        "PONTE"
      ],
      "user_headers_without_brackets": true,
      "convert_user_headers": {
        "verse": "[VERSE]",
        "куплет": "[VERSE]",
        "strophe": "[VERSE]",
        "chorus": "[CHORUS]",
        "припев": "[CHORUS]",
        "bridge": "[BRIDGE]",
        "бридж": "[BRIDGE]",
        "hook": "[HOOK]",
        "рефрен": "[HOOK]",
        "insane": "[HOOK]",
        "final chorus": "[FINAL CHORUS]",
        "финальный припев": "[FINAL CHORUS]",
        "outro": "[OUTRO]"
      },
      "forbid_merging_sections": true,
      "detect_duplicate_headers": "separate_blocks"
    },
    "section_logic": {
      "split_on_header": true,
      "treat_duplicates_as_new_sections": true,
      "prohibit_monolithic_merge": true,
      "max_lines_per_section": 20,
      "hook_isolated": true,
      "bridge_isolated": true,
      "final_chorus_after_chorus": true,
      "calculate_order_by_user": true
    },
    "vocal_fusion": {
      "allow_user_override": true,
      "auto_detect": true,
      "user_mix": [
        "male",
        "female",
        "choir",
        "growl",
        "scream",
        "soft",
        "whisper",
        "raspy"
      ],
      "allowed_outputs": [
        "solo_male",
        "solo_female",
        "duet_mf",
        "duet_mm",
        "duet_ff",
        "choir_male",
        "choir_female",
        "choir_mixed"
      ],
      "fusion_rules": {
        "priority": "user_first",
        "analysis_weight": 0.65,
        "user_weight": 0.35,
        "max_bias_limit": 0.25
      }
    },
    "bpm_logic": {
      "user_lock": true,
      "global_lock": true,
      "max_section_variation": 5,
      "prevent_random_jumps": true,
      "fallback_bpm": 120
    },
    "tone_logic": {
      "user_lock": true,
      "fallback_key": "C minor",
      "align_sections": true
    },
    "style_prompt": {
      "all_annotations_in_english": true,
      "annotation_format": "(annotation: value)",
      "force_in_brackets": true,
      "instrumental_break_format": "(INSTRUMENTAL_BREAK: type)",
      "end_marker": "[END]"
    },
    "multilingual_engine": {
      "detect_language": true,
      "translate_to_english_for_analysis": true,
      "preserve_original_language": true,
      "section_keywords": {
        "ru": [
          "куплет",
          "припев",
          "бридж",
          "финал",
          "рефрен"
        ],
        "de": [
          "strophe",
          "refrain",
          "brucke",
          "schluss"
        ]
      }
    },
    "error_prevention": {
      "block_merge_protection": true,
      "prevent_header_injection": true,
      "reject_ambiguous_headers": false,
      "log_header_collisions": true
    },
    "final_output": {
      "align_vocal_style_with_analysis": true,
      "merge_user_and_core_results": true,
      "produce_complete_style_prompt": true,
      "section_order_respect_user": true,
      "auto_insert_missing_sections": false
    },
    "ui_localization": {
      "supported_languages": [
        "en",
        "ru",
        "de"
      ],
      "default_language": "en",
      "translatable_elements": [
        "title",
        "description",
        "buttons",
        "tabs",
        "placeholders",
        "helpers"
      ]
    },
    "license": {
      "type": "StudioCore-Open-Use License v1.2",
      "text": "This software and all its components are licensed under the StudioCore Open-Use License v1.2. Allowed for personal and commercial use. Prohibited: reselling the engine's code as is. For collaboration, partnership or purchasing enterprise access contact: ssv8240@gmail.com. Core emotional system will continue expanding in future versions.",
      "contact": "ssv8240@gmail.com"
    }
  }
}
