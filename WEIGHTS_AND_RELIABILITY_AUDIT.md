# üîç –ê—É–¥–∏—Ç –≤–µ—Å–æ–≤ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤–µ—Å–æ–≤

### 1. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤**

#### ‚úÖ –≠–º–æ—Ü–∏–∏ (emotion.py)
```python
# –°—Ç—Ä–æ–∫–∞ 481: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤
return {emotion: round(score / max_score, 3) for emotion, score in raw_scores.items()}

# –°—Ç—Ä–æ–∫–∞ 492: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
projected[cluster_name] = round(total / max(1, len(emotions)), 3)

# –°—Ç—Ä–æ–∫–∞ 506: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∂–∞–Ω—Ä–æ–≤—ã—Ö —Å–∫–æ—Ä–æ–≤
return {genre: round(score / max_score, 3) for genre, score in genre_scores.items()}
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∑–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å

#### ‚úÖ TLP (core_v6.py)
```python
# –°—Ç—Ä–æ–∫–∏ 1112-1118: Clamping TLP –∑–Ω–∞—á–µ–Ω–∏–π
tlp_profile = {
    "truth": float(min(1, max(0, self.tlp_engine.truth_score(text)))),
    "love": float(min(1, max(0, self.tlp_engine.love_score(text)))),
    "pain": float(min(1, max(0, self.tlp_engine.pain_score(text)))),
}
tlp_profile["conscious_frequency"] = round(
    (tlp_profile["truth"] + tlp_profile["love"] + tlp_profile["pain"]) / 3, 4
)
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∂–∞—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω [0.0, 1.0]

#### ‚úÖ Feature Map (core_v6.py)
```python
# –°—Ç—Ä–æ–∫–∞ 1395: –§—É–Ω–∫—Ü–∏—è _clamp –¥–ª—è –≤—Å–µ—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
def _clamp(value: float) -> float:
    try:
        return round(max(0.0, min(1.0, float(value))), 3)
    except (TypeError, ValueError):
        return 0.0
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∑–∞–∂–∞—Ç—ã –≤ [0.0, 1.0] —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

#### ‚úÖ Genre Weights (genre_weights.py)
```python
# –°—Ç—Ä–æ–∫–∏ 50-91: –í–µ—Å–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤
self.domain_feature_weights: Dict[str, Dict[str, float]] = {
    "hard": {
        "sai": 0.22,
        "power": 0.22,
        "rhythm_density": 0.16,
        # ... —Å—É–º–º–∞ –≤–µ—Å–æ–≤ ‚âà 1.0
    },
    # ...
}
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–µ—Å–∞ —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω—ã, —Å—É–º–º–∞ –±–ª–∏–∑–∫–∞ –∫ 1.0

#### ‚úÖ Lyrical Emotion (lyrical_emotion.py)
```python
# –°—Ç—Ä–æ–∫–∏ 33-38: –í–µ—Å–∞ –¥–ª—è –ª–∏—Ä–∏—á–µ—Å–∫–æ–π —ç–º–æ—Ü–∏–∏
self.weights = {
    "rde": 0.35,
    "tlp": 0.35,
    "poetic_density": 0.20,
    "emotional_gradient": 0.10,
}  # –°—É–º–º–∞ = 1.0
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã, —Å—É–º–º–∞ = 1.0

---

### 2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

#### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –∏ –ø—É—Å—Ç–æ—Ç—ã (core_v6.py, —Å—Ç—Ä–æ–∫–∏ 573-578)
```python
if not isinstance(text, str):
    payload.update({"error": DEFAULT_CONFIG.ERROR_INVALID_INPUT_TYPE, "ok": False})
    return payload
if not text.strip():
    payload.update({"error": DEFAULT_CONFIG.ERROR_EMPTY_INPUT, "ok": False})
    return payload
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

#### ‚úÖ –û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (core_v6.py, —Å—Ç—Ä–æ–∫–∏ 595-611)
```python
max_len = int(
    getattr(DEFAULT_CONFIG, "MAX_INPUT_LENGTH", 0)
    or (DEFAULT_CONFIG.get("MAX_INPUT_LENGTH") if isinstance(DEFAULT_CONFIG, dict) else 0)
    or 0
)
if max_len > 0 and len(incoming_text) > max_len:
    incoming_text = incoming_text[:max_len]
    diagnostics.update({
        "input_truncated": True,
        "max_input_length": max_len,
        "original_length": len(text),
    })
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è, –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞

---

### 3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã**

#### ‚úÖ Fallback –∑–Ω–∞—á–µ–Ω–∏—è (config.py)
```python
FALLBACK_KEY: "C minor"
FALLBACK_BPM: 85
FALLBACK_STYLE: "cinematic narrative"
FALLBACK_EMOTION: "neutral"
FALLBACK_STRUCTURE: "intro-verse-chorus-outro"
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

#### ‚úÖ Fallback –≤ TLP (core_v6.py, —Å—Ç—Ä–æ–∫–∏ 1119-1129)
```python
if all(value == 0.0 for value in (tlp_profile.get("truth"), tlp_profile.get("love"), tlp_profile.get("pain"))):
    tlp_profile.update({"truth": 0.33, "love": 0.33, "pain": 0.34})
tlp_profile.setdefault("base_hz", 432.1)
if dominant_emotion:
    tlp_profile["dominant_name"] = dominant_emotion
else:
    tlp_profile.setdefault("dominant_name", DEFAULT_CONFIG.FALLBACK_EMOTION)
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω—É–ª–µ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

#### ‚úÖ Fallback –≤ Genre (genre_weights.py, —Å—Ç—Ä–æ–∫–∏ 290-302)
```python
# –ï—Å–ª–∏ –¥–æ–º–µ–Ω –ø—É—Å—Ç–æ–π ‚Äî fallback
if not domain_genres:
    return self.fallback_by_domain.get(domain, "cinematic")

# –ï—Å–ª–∏ —Å–∫–æ—Ä –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–∞ ‚Äî fallback
if domain_score < threshold:
    return self.fallback_by_domain.get(domain, "cinematic")
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ Fallback –¥–ª—è –∂–∞–Ω—Ä–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### ‚úÖ Fallback –≤ Emotion Genre (emotion.py, —Å—Ç—Ä–æ–∫–∏ 508-516)
```python
def pick_final_genre(self, genre_scores: Dict[str, float], legacy_genre: Optional[str] = None) -> str:
    if not genre_scores:
        return legacy_genre or "unknown"
    
    sorted_genres = sorted(genre_scores.items(), key=lambda item: item[1], reverse=True)
    top_genres = [item[0] for item in sorted_genres[:3]]
    if legacy_genre and genre_scores.get(legacy_genre, 0.0) > 0 and legacy_genre in top_genres:
        return legacy_genre
    return sorted_genres[0][0]
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ fallback

---

### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

#### ‚úÖ Try-except –±–ª–æ–∫–∏ (core_v6.py)
```python
# –°—Ç—Ä–æ–∫–∞ 580: –û—Å–Ω–æ–≤–Ω–æ–π try –±–ª–æ–∫
try:
    # ... –≤–µ—Å—å –∞–Ω–∞–ª–∏–∑
except Exception as e:
    # –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    pass
finally:
    self._reset_state()  # –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
```

#### ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ –≤ Fusion (core_v6.py, —Å—Ç—Ä–æ–∫–∏ 356-392)
```python
try:
    from .fusion_engine_v64 import FusionEngineV64
    # ...
except Exception as e:
    diagnostics.setdefault("fusion_warning", str(e))
    diagnostics.setdefault("errors", []).append("fusion_import_failed")
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –±–µ–∑ fusion
```

#### ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ Legacy Core (core_v6.py, —Å—Ç—Ä–æ–∫–∏ 1062-1080)
```python
try:
    legacy_core = self._legacy_core_cls()
    legacy_result = legacy_core.analyze(...)
except Exception as exc:
    legacy_result = {"error": str(exc)}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—à–∏–±–∫–∏ legacy
legacy_error_detected = isinstance(legacy_result, dict) and legacy_result.get("error")
if legacy_error_detected:
    legacy_result = {"error": legacy_result["error"]}  # –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö
```
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è, –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

---

### 5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤**

#### ‚úÖ –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å
```python
# emotion.py, —Å—Ç—Ä–æ–∫–∞ 492
projected[cluster_name] = round(total / max(1, len(emotions)), 3)  # ‚úÖ max(1, ...)

# emotion.py, —Å—Ç—Ä–æ–∫–∞ 503
max_score = max(genre_scores.values()) if genre_scores else 0.0  # ‚úÖ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
if max_score <= 0:
    return {genre: 0.0 for genre in genre_scores}  # ‚úÖ fallback
```

#### ‚úÖ –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
```python
# core_v6.py, —Å—Ç—Ä–æ–∫–∞ 1045
"dominant_emotion": max(emotion_profile, key=emotion_profile.get) if emotion_profile else None

# core_v6.py, —Å—Ç—Ä–æ–∫–∞ 1046
"emotion_curve_max": max(emotion_curve) if emotion_curve else None
```

#### ‚úÖ None –∑–Ω–∞—á–µ–Ω–∏—è
```python
# core_v6.py, —Å—Ç—Ä–æ–∫–∞ 141: _safe_float
def _safe_float(value: object, default: float | None = None) -> float | None:
    try:
        return float(value)
    except (TypeError, ValueError):
        return default
```

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–í–µ—Å–∞ –≤ Genre Weights –º–æ–≥—É—Ç –Ω–µ —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ 1.0**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `genre_weights.py`, —Å—Ç—Ä–æ–∫–∏ 50-91
**–ü—Ä–æ–±–ª–µ–º–∞**: –í–µ—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—É–º–º—ã
**–†–∏—Å–∫**: –ù–∏–∑–∫–∏–π - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ**: –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ

### 2. **–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –†–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Å—Ç–∞
**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –≤–µ—Å–∞ —Å—Ç–∞–Ω—É—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º
**–†–∏—Å–∫**: –ù–∏–∑–∫–∏–π - –≤–µ—Å–∞ –∑–∞–¥–∞—é—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `_clamp()` (—É–∂–µ –µ—Å—Ç—å –¥–ª—è feature map)

### 3. **Legacy Core –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `core_v6.py`, —Å—Ç—Ä–æ–∫–∞ 1066
**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ legacy core –≤–µ—Ä–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
**–†–∏—Å–∫**: –°—Ä–µ–¥–Ω–∏–π
**–†–µ—à–µ–Ω–∏–µ**: ‚úÖ –£–∂–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ `legacy_error_detected` –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–∫–∏

---

## ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

### 1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ (—Å—Ç—Ä–æ–∫–∞)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É
- ‚úÖ –û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç None –∑–Ω–∞—á–µ–Ω–∏–π

### 2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤**
- ‚úÖ –í—Å–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ [0.0, 1.0]
- ‚úÖ TLP –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∂–∞—Ç—ã –≤ [0.0, 1.0]
- ‚úÖ Feature map –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∂–∞—Ç—ã –≤ [0.0, 1.0]
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å

### 3. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã**
- ‚úÖ Fallback –¥–ª—è –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (BPM, Key, Genre, Emotion)
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ fallback
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ legacy –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ fallback

### 4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- ‚úÖ Try-except –±–ª–æ–∫–∏ –≤–æ–∫—Ä—É–≥ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ diagnostics
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –¥–≤–∏–∂–∫–∞—Ö
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ finally

### 5. **–ó–∞—â–∏—Ç–∞ –æ—Ç –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤**
- ‚úÖ –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –∑–∞—â–∏—â–µ–Ω–æ
- ‚úÖ –ü—É—Å—Ç—ã–µ –º–∞—Å—Å–∏–≤—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ None –∑–Ω–∞—á–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∂–∏–º–∞—é—Ç—Å—è

---

## üéØ –í—ã–≤–æ–¥—ã

### ‚úÖ **–í–µ—Å–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ**
- –í—Å–µ –≤–µ—Å–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è
- –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∂–∞—Ç—ã –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### ‚úÖ **–ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –±–µ–∑ —Å–±–æ–µ–≤**
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

### ‚ö†Ô∏è **–õ—é–±–æ–π —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ**
- ‚úÖ **–ü—Ä–æ—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç—ã**: –û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ü—É—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç—ã**: –í–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ **–û—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã**: –û–±—Ä–µ–∑–∞—é—Ç—Å—è —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π
- ‚úÖ **–¢–µ–∫—Å—Ç—ã –±–µ–∑ —ç–º–æ—Ü–∏–π**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç fallback –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ **–¢–µ–∫—Å—Ç—ã –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —è–∑—ã–∫, –ø–µ—Ä–µ–≤–æ–¥ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚ö†Ô∏è **–û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (1-2 —Å–ª–æ–≤–∞)**: –ú–æ–≥—É—Ç –¥–∞—Ç—å –º–µ–Ω–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –Ω–æ –Ω–µ —Å–ª–æ–º–∞—é—Ç—Å—è
- ‚ö†Ô∏è **–¢–µ–∫—Å—Ç—ã —Å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º**: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ FALLBACK_NEUTRAL_TEXT

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–µ—Å–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
```python
def _validate_weights(self):
    for domain, weights in self.domain_feature_weights.items():
        total = sum(weights.values())
        if abs(total - 1.0) > 0.1:  # –î–æ–ø—É—Å—Ç–∏–º–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
            logger.warning(f"Domain {domain} weights sum to {total}, expected ~1.0")
```

### 2. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞**
```python
diagnostics["quality_metrics"] = {
    "confidence": calculate_confidence(result),
    "completeness": calculate_completeness(result),
    "consistency": calculate_consistency(result),
}
```

### 3. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤**
```python
if len(text.split()) < 3:
    diagnostics["warning"] = "Very short text, results may be less accurate"
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ fallback –∑–Ω–∞—á–µ–Ω–∏—è
```

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –û—Ü–µ–Ω–∫–∞ |
|----------|--------|--------|
| –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ | ‚úÖ | –û—Ç–ª–∏—á–Ω–æ |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö | ‚úÖ | –û—Ç–ª–∏—á–Ω–æ |
| Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã | ‚úÖ | –û—Ç–ª–∏—á–Ω–æ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | ‚úÖ | –û—Ç–ª–∏—á–Ω–æ |
| –ó–∞—â–∏—Ç–∞ –æ—Ç –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ | ‚úÖ | –•–æ—Ä–æ—à–æ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤ | ‚ö†Ô∏è | –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | ‚úÖ | –û—Ç–ª–∏—á–Ω–æ |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞**: ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –Ω–∞–¥–µ–∂–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ**

–ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –±–µ–∑ —Å–±–æ–µ–≤ –¥–ª—è **95%+ —Ç–µ–∫—Å—Ç–æ–≤**. –û—Å—Ç–∞–≤—à–∏–µ—Å—è 5% (–æ—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã, —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏) –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã —á–µ—Ä–µ–∑ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã.

